# Image
import { Callout } from 'nextra/components'
 
## Creating an image

A [dockerfile](https://docs.docker.com/reference/dockerfile/) contains the instructions needed to build a suitable operating system to run an application.

### Sample 

```dockerfile
FROM node AS build

WORKDIR /client

COPY package.json yarn.lock ./
RUN yarn install

COPY . .

RUN yarn run build

FROM nginx:stable-alpine
COPY --from=build /client/dist /usr/share/nginx/html
COPY --from=build /client/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

> The sample shows common steps taken to build and deploy a `React` application. This dockerfile is optimized to use multi-stage builds and leverage layer cache. 

### Layer Cache

```dockerfile {5, 8}
FROM node AS build

WORKDIR /client

COPY package.json yarn.lock ./
RUN yarn install

COPY . .

RUN yarn run build

FROM nginx:stable-alpine
COPY --from=build /client/dist /usr/share/nginx/html
COPY --from=build /client/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

Each instruction in a Dockerfile translates to a layer in the final image and will be pulled from the cache if it is clean. If a layer becomes dirty, then the layers after it will be invalidated as well. Consider what happens if lines 5 and 8 are swapped. If that happens, then more invalidations will occur since `COPY . .` includes the source code that changes all the time! [Read more](https://docs.docker.com/build/cache/)

### Multi-stage builds

```dockerfile {1,12-14}
FROM node AS build

WORKDIR /client

COPY package.json yarn.lock ./
RUN yarn install

COPY . .

RUN yarn run build

FROM nginx:stable-alpine
COPY --from=build /client/dist /usr/share/nginx/html
COPY --from=build /client/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

You use multiple `FROM` statements for each new stage of the build and you can selectively copy artifacts from another stage. This leads to a smaller final image size. [Read more](https://docs.docker.com/build/building/multi-stage/)

### Building an Image

```bash
docker build -t <image_name> .
```

> The last argument specifies where the dockerfile is. In this example, it is in the current directory `.`.